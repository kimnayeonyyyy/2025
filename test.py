import streamlit as st
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

# =============================
# ì„¸ê·  ì¦ì‹ ëª¨ë¸ (ë¡œì§€ìŠ¤í‹± ì„±ì¥ì‹)
# =============================
def logistic_growth(t, N0, r, K):
    """
    ë¡œì§€ìŠ¤í‹± ì„±ì¥ ëª¨ë¸
    N(t) = K / (1 + ((K - N0)/N0) * exp(-r*t))
    """
    return K / (1 + ((K - N0) / N0) * np.exp(-r * t))

# =============================
# Streamlit ê¸°ë³¸ ì„¤ì •
# =============================
st.set_page_config(page_title="ì„¸ê·  ì¦ì‹ ì‹œë®¬ë ˆì´í„°", page_icon="ğŸ§«", layout="wide")

st.title("ğŸ§« ì„¸ê·  ì¦ì‹ ì‹œë®¬ë ˆì´í„°")
st.markdown(
    """
ì„¸ê·  ì§‘ë‹¨ì€ ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ **Sìí˜•(sigmoid) ì„±ì¥ ê³¡ì„ **ì„ ë³´ì…ë‹ˆë‹¤.  
ì‚¬ì´ë“œë°”ì—ì„œ ì´ˆê¸° ê°œì²´ìˆ˜, ì„±ì¥ë¥ , í™˜ê²½ ìˆ˜ìš©ë ¥ì„ ì¡°ì ˆí•´ë³´ê³  ì§‘ë‹¨ í¬ê¸° ë³€í™”ë¥¼ í™•ì¸í•˜ì„¸ìš”.
    """
)

# =============================
# ì‚¬ì´ë“œë°”: ë§¤ê°œë³€ìˆ˜ ì…ë ¥
# =============================
with st.sidebar:
    st.header("âš™ï¸ ë§¤ê°œë³€ìˆ˜ ì„¤ì •")
    N0 = st.slider("ì´ˆê¸° ê°œì²´ìˆ˜ (Nâ‚€)", 1, 100, 10)   # ì´ˆê¸°ê°’
    r = st.slider("ì„±ì¥ë¥  (r)", 0.01, 1.0, 0.2, 0.01) # ì„¸ê·  ì¦ì‹ ì†ë„
    K = st.slider("í™˜ê²½ ìˆ˜ìš©ë ¥ (K)", 50, 2000, 500, 10) # ìµœëŒ€ ê°œì²´ìˆ˜
    T = st.slider("ì´ ì‹œê°„ (t max)", 10, 200, 50, 1)   # ì‹œë®¬ë ˆì´ì…˜ ì‹œê°„
    dt = st.slider("ì‹œê°„ ê°„ê²© (Î”t)", 0.1, 5.0, 1.0, 0.1) # ì‹œê°„ í•´ìƒë„

# =============================
# ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
# =============================
t = np.arange(0, T+dt, dt)        # ì‹œê°„ ë²¡í„°
N = logistic_growth(t, N0, r, K)  # ì„¸ê·  ê°œì²´ìˆ˜ ê³„ì‚°

# DataFrameìœ¼ë¡œ ë³€í™˜ (ê·¸ë˜í”„ & ë‹¤ìš´ë¡œë“œìš©)
df = pd.DataFrame({"time": t, "bacteria": N})

# =============================
# ê²°ê³¼ ì‹œê°í™”
# =============================
col1, col2 = st.columns([1.2, 1])

# Streamlit ë‚´ì¥ line_chart
with col1:
    st.subheader("ğŸ“ˆ ì„¸ê·  ê°œì²´ìˆ˜ ì‹œê°„ ë³€í™”")
    st.line_chart(df.set_index("time"))

# Matplotlib ê·¸ë˜í”„
with col2:
    st.subheader("ğŸ“Š ì„±ì¥ ê³¡ì„  (Matplotlib)")
    fig, ax = plt.subplots(figsize=(5,4))
    ax.plot(t, N, label="ì„¸ê·  ê°œì²´ìˆ˜", color="green")
    ax.set_xlabel("ì‹œê°„")
    ax.set_ylabel("ê°œì²´ìˆ˜")
    ax.set_title("ì„¸ê·  ì¦ì‹ ê³¡ì„ ")
    ax.legend()
    st.pyplot(fig, use_container_width=True)

# =============================
# ë°ì´í„° ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥
# =============================
st.divider()
st.subheader("ğŸ’¾ ë°ì´í„° ë‹¤ìš´ë¡œë“œ")
st.download_button(
    label="CSV ë‹¤ìš´ë¡œë“œ",
    data=df.to_csv(index=False),
    file_name="bacteria_growth.csv",
    mime="text/csv",
)

# =============================
# í•™ìŠµ í¬ì¸íŠ¸ ì„¤ëª…
# =============================
with st.expander("ğŸ“š í•™ìŠµ í¬ì¸íŠ¸"):
    st.markdown(
        """
- **ì§€ìˆ˜ì  ì¦ê°€ê¸°**: ì´ˆê¸°ì—ëŠ” ë¹ ë¥´ê²Œ ì¦ê°€ (ìì›ì´ ì¶©ë¶„).
- **ì •ì²´ê¸°**: ê°œì²´ ìˆ˜ê°€ ì»¤ì§ˆìˆ˜ë¡ ì„±ì¥ë¥  ê°ì†Œ.
- **í™˜ê²½ ìˆ˜ìš©ë ¥(K)**ì— ê°€ê¹Œì›Œì§ˆìˆ˜ë¡ ì„±ì¥ì´ ë©ˆì¶¤.
- ì‹¤ì œ ì„¸ê·  ë°°ì–‘ ì‹¤í—˜ì—ì„œë„ ìœ ì‚¬í•œ ê³¡ì„ ì„ ê´€ì°°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        """
    )
